# [脆弱性の英語正式名] — [日本語での簡潔な説明]

<!--
  このテンプレートは docs/ 配下の各ラボドキュメントの雛形です。
  新規作成・既存ドキュメントの改善時にこのテンプレートに沿って記述してください。

  ■ 設計方針
  脆弱性の説明が学習の核心。セクションの枠だけ作って中身がスカスカでは意味がない。
  「この脆弱性がなぜ生まれ、どう悪用され、なぜ対策が効くのか」を
  技術的に深く理解させることがこのテンプレートの目的。

  ■ 全体の流れ: 正常 → 脆弱 → 攻撃 → 対策
  1. まず「正常な仕組み」を理解させる
  2. その仕組みの「どこに穴があるか」をコード付きで示す
  3. 攻撃の全シナリオを技術的に説明する
  4. 対策を「なぜ効くのか」まで掘り下げて説明する

  ■ 図の配置
  攻撃図と対策図はまとめて並べない。
  - 攻撃図 → 「攻撃の仕組み」セクション内に配置
  - 対策図 → 「対策」セクション内に配置
  それぞれの説明文脈の中に図を置くことで、読者が文脈を見失わない。

  ■ ルール
  - [ ] で囲まれた部分はラボごとに置き換える
  - 「必須」マークのセクションは必ず記述する
  - 「任意」マークのセクションは該当する場合のみ記述する
  - 日本語で記述する（学習者向け）
  - コード例にはコメントで「なぜ脆弱か」「なぜ安全か」を明記する
-->

> [専門用語をできるだけ使わず、「何が起きるか」を1文で説明する。初学者がこの1文だけ読んで「このラボで何を学ぶか」がわかるように書く。]
<!-- 注意: 「一言で言うと」等のラベルは付けず、要約文だけを書くこと -->

---

<!-- ============================================================
  セクション: 対象ラボ（必須）
  - 既存の概要・攻撃例・技術スタック・難易度は維持
  - 「前提知識」フィールドを追加して学習順序を明示する
  - 複数シナリオがある場合はテーブルを複数作る
============================================================ -->

## 対象ラボ

| 項目 | 内容 |
|------|------|
| **概要** | [何が脆弱で、結果として何が起きるかを具体的に記述] |
| **攻撃例** | `[具体的な入力値、curl コマンド、ペイロード等]` |
| **技術スタック** | [Hono API / React / PostgreSQL 等、使用するコンポーネント] |
| **難易度** | ★☆☆ 入門 / ★★☆ 中級 / ★★★ 上級 |
| **前提知識** | [このラボの前に理解しておくべき概念やラボ。例: 「HTTPの基本」「Step 2: XSS」等] |

<!-- 複数のラボシナリオがある場合は見出しを分けてテーブルを繰り返す -->

---

<!-- ============================================================
  セクション: この脆弱性を理解するための前提（必須）

  ■ このセクションの役割:
  脆弱性の話に入る前に「正常な仕組み」を理解させ、
  その仕組みの「どこに穴があるか」をコード付きで示す。
  「何が壊れているか」を知るにはまず「正常」を知る必要がある。

  ■ 書き方のポイント:
  - HTTP/Cookie/SQL 等の基礎を毎回ゼロから書く必要はない
  - このラボの脆弱性に直接関わる部分だけに絞って書く
  - 「なぜこの仕組みが存在するのか」→「その仕組みのどこに弱点があるか」
    の流れで書くと自然に読める
============================================================ -->

## この脆弱性を理解するための前提

### [関連する技術・仕組みの名前] の仕組み

[正常系の動作を具体的に説明する。
例えば SQLi なら「アプリがSQLを使ってDBにデータを問い合わせる流れ」、
CSRF なら「Cookieベースのセッション管理がどう動くか」を書く。

ポイント: 全体像ではなく、この脆弱性に関係する部分だけに絞ること。]

```
[正常な動作のコード例やリクエスト/レスポンス例を示す。
学習者が「通常はこう動くのか」と理解できるようにする。]
```

### どこに脆弱性が生まれるのか

[上で説明した正常な仕組みの「どの部分」に問題があるかを示す。
「開発者が〜を信頼してしまう」「〜の検証を省略してしまう」
のように、脆弱性が生まれる瞬間を具体的に指摘する。]

```typescript
// ⚠️ この部分が問題 — [なぜ問題なのかを明記]
[脆弱なコードパターンを示す。
学習者が「ここがダメなのか」と一目でわかるようにする。]
```

---

<!-- ============================================================
  セクション: 攻撃の仕組み（必須）

  ■ このセクションの役割:
  攻撃の全シナリオを技術的に深く説明する。
  「1. 攻撃者が... 2. サーバーが...」だけの薄い番号リストにしない。
  各ステップに「なぜそうなるか」の説明と、実際に生成される
  リクエスト/クエリ/レスポンスのコード例を必ず添える。

  ■ 3つのサブセクションで構成:
  1. 攻撃のシナリオ: 物語として読める番号付きステップ
  2. なぜ成功するのか: 「1つでも欠ければ成立しない」視点で成立条件を整理
  3. 被害の範囲: 抽象的な「危険」ではなく、具体的な被害を記述

  ■ 攻撃図の配置:
  攻撃フロー図はこのセクションの冒頭に配置する。
============================================================ -->

## 攻撃の仕組み

![攻撃フロー](diagrams/[lab-name]-attack.svg)

### 攻撃のシナリオ

<!-- 「誰が」「何を」「どうやって」攻撃するのか、物語として読めるように書く。
     各ステップに「なぜそうなるのか」の技術的説明を必ず添える。
     番号はフロー図のステップ番号に対応させる。 -->

1. **攻撃者** が [具体的なアクション]

   [なぜこのアクションが可能なのか、1-2文で補足する。]

2. **[サーバー / ブラウザ / 被害者]** が [どう処理するか]

   [内部で何が起きているかを技術的に説明する。
   例: 「サーバーはこの入力をそのままSQL文に結合する。
   結果として生成されるSQLは以下のようになる:」]

   ```
   [この時点で実際に生成されるリクエスト/クエリ/レスポンス等を示す。
   学習者が「こんなものが生成されてしまうのか」と実感できるようにする。]
   ```

3. [攻撃の結果]

   [攻撃者が最終的に何を得られるか、被害者に何が起きるかを具体的に記述する。]

### なぜ成功するのか

<!-- 攻撃が成立するための条件を整理する。
     「この条件が1つでも欠ければ攻撃は成立しない」という視点で書く。 -->

| 条件 | 説明 |
|------|------|
| [条件 1] | [なぜこの条件が攻撃を可能にするのか] |
| [条件 2] | [なぜこの条件が攻撃を可能にするのか] |
| [条件 3] | [なぜこの条件が攻撃を可能にするのか] |

### 被害の範囲

<!-- この攻撃が成功した場合の具体的な被害を列挙する。
     「データ漏洩」のような抽象的な言葉ではなく、
     「全ユーザーのメールアドレスとパスワードハッシュが取得される」
     のように具体的に書く。 -->

- **機密性**: [何の情報が漏洩するか]
- **完全性**: [何のデータが改ざんされるか]
- **可用性**: [サービスにどんな影響があるか]

---

<!-- ============================================================
  セクション: 対策（必須）

  ■ このセクションの役割:
  「〜を使えば安全」で終わらせない。
  根本原因を端的に述べ、安全なコードを示し、
  「なぜこの修正で攻撃が防げるのか」を技術的に説明する。

  ■ 4つのサブセクションで構成:
  1. 根本原因: 問題の本質を1-2文で
  2. 安全な実装: コード + 「なぜ安全か」の技術的説明
  3. コード比較: diff形式で脆弱→安全の違いを一目で
  4. その他の防御策: 根本対策/多層防御/検知を区別

  ■ 対策図の配置:
  対策フロー図はこのセクションの冒頭に配置する。
============================================================ -->

## 対策

![対策フロー](diagrams/[lab-name]-defense.svg)

### 根本原因

[攻撃が成立する「本質的な原因」を1-2文で端的に述べる。
「入力値の検証がない」のような表面的な記述ではなく、
もっと深い原因を書く。
例: 「ユーザー入力がコード（SQL構文）として解釈される設計になっている」]

### 安全な実装

[対策の具体的なコードを示し、**なぜこの修正で攻撃が防げるのか**を
技術的に説明する。「パラメータ化クエリを使う」だけでなく、
「パラメータ化クエリではユーザー入力が常にリテラル値として扱われるため、
SQL構文として解釈されることがない」まで踏み込んで書く。]

```typescript
// ✅ [なぜ安全なのかをコメントで明記]
[安全なコードパターンを示す]
```

#### 脆弱 vs 安全: コード比較

<!-- 脆弱なコードと安全なコードの差分を diff 形式で示す。
     学習者が「この1行の違いが全てを変える」と実感できるようにする。 -->

```diff
- [脆弱なコード行]
+ [安全なコード行]
```

[この1行の違いが何を変えるのか。入力値がどう処理されるかの違いを説明する。]

### その他の防御策

<!-- メインの対策以外に取れる多層防御を紹介する。
     「根本対策」と「補助的な対策」を明確に区別すること。
     全部を同列に並べると、何が一番大事かわからなくなる。 -->

| 対策 | 種類 | 説明 |
|------|------|------|
| [対策 1] | 根本対策 | [最も効果的な対策。これが必須。] |
| [対策 2] | 多層防御 | [根本対策に加えて行うとより安全になる施策。] |
| [対策 3] | 検知 | [攻撃の試みを検知する仕組み。] |

---

<!-- ============================================================
  セクション: ハンズオン手順（必須）

  ■ このセクションの役割:
  学習者が実際に手を動かして脆弱性を体験する手順。
  「体験して学ぶ」ラボの核心部分。

  ■ 必ず2段階で構成:
  Step 1: 脆弱バージョンで攻撃を体験（攻撃が成功する）
  Step 2: 安全バージョンで防御を確認（同じ攻撃が失敗する）

  ■ 書き方のポイント:
  - コマンドやURLは具体的に書き、コピペで試せるようにする
  - 結果の確認方法だけでなく「なぜこの結果になるか」を考えさせる問いを添える
  - 確認ポイントでは「安全だから安全」のような循環論法を認めない
============================================================ -->

## ハンズオン手順

### Step 1: 脆弱バージョンで攻撃を体験

**ゴール**: [何が成功することを確認するか、1文で]

1. [環境の準備手順。例: 開発サーバーを起動する、ブラウザで特定のURLを開く]

2. [攻撃の実行手順。具体的なコマンドやブラウザ操作を記述]

   ```bash
   # [実行するコマンドの例]
   curl -X POST http://localhost:3000/api/labs/[lab-name]/vulnerable/[endpoint] \
     -H "Content-Type: application/json" \
     -d '{"[key]": "[攻撃ペイロード]"}'
   ```

3. [結果の確認方法と観察ポイント]

   - 何が返ってくるか / 画面に何が表示されるか
   - DevTools のどのタブで何を確認するか
   - **この結果が意味すること**: [なぜこうなったのかを考えさせる問い]

### Step 2: 安全バージョンで防御を確認

**ゴール**: 同じ攻撃が失敗することを確認する

1. [安全なエンドポイントに切り替える手順]

   ```bash
   # 同じ攻撃を安全なバージョンに対して実行
   curl -X POST http://localhost:3000/api/labs/[lab-name]/secure/[endpoint] \
     -H "Content-Type: application/json" \
     -d '{"[key]": "[攻撃ペイロード]"}'
   ```

2. [攻撃がどのように防がれるか確認]

3. [コードの差分を確認する]

   - `backend/src/labs/[lab-name].ts` の脆弱版と安全版を比較
   - **どの行が違いを生んでいるか** に注目

### 確認ポイント

以下を自分の言葉で説明できれば、このラボは完了です:

- [ ] この脆弱性が発生するための条件は何か
- [ ] 攻撃者は何を入力し、内部でどう処理され、結果として何が起きるか
- [ ] 根本原因はコード/設計のどこにあるか
- [ ] 安全な実装は「なぜ」この攻撃を無効化するのか（「安全だから安全」ではダメ）

---

<!-- ============================================================
  セクション: 実装メモ（必須）
  - ラボの実装時に参照する技術的なメモ
  - ファイルパスや DB テーブルなど具体的な情報を記述
============================================================ -->

## 実装メモ

| 項目 | パス |
|------|------|
| 脆弱エンドポイント | `/api/labs/[lab-name]/vulnerable/[endpoint]` |
| 安全エンドポイント | `/api/labs/[lab-name]/secure/[endpoint]` |
| バックエンド | `backend/src/labs/[lab-name].ts` |
| フロントエンド | `frontend/src/pages/[LabName].tsx` |
| DB (該当する場合) | `docker/db/init.sql` に [テーブル名] を追加 |

[その他の実装上の注意点]

---

<!-- ============================================================
  セクション: 現実世界での事例（任意）
  - 有名なセキュリティインシデントがある場合に記述
  - 「教科書の話ではなく実際に起きたこと」と示すことで学習の動機付けになる
  - 1-2件に絞り、概要のみ簡潔に書く
  - 該当するインシデントがないラボ（設計パターン系など）では省略可
============================================================ -->

## 現実世界での事例

| 年 | インシデント | 概要 |
|----|-------------|------|
| [年] | [インシデント名] | [何が起きたか、どの脆弱性が原因だったかを1-2文で] |

---

<!-- ============================================================
  セクション: 関連ラボ（任意）
  - 他のラボと明確な技術的関連がある場合に記述
  - 「前提→発展」「同じカテゴリ」「組み合わせ」等の関連を明示
  - 無理にすべてのラボに書く必要はない
============================================================ -->

## 関連ラボ

| ラボ | 関連性 |
|------|--------|
| [関連ラボ名](../stepXX-xxx/yyy.md) | [どう関連するかの説明。例: 「XSSで盗んだCookieを使ってセッションハイジャックを行える」] |

---

<!-- ============================================================
  セクション: 参考資料（必須）
  - OWASP のリンクは必須
  - CWE 番号がある場合は含める
  - その他の有用なリンクがあれば追加
============================================================ -->

## 参考資料

- [OWASP - [脆弱性名]]([OWASPのURL])
- [CWE-[番号]: [名前]]([CWEのURL]) <!-- 該当する場合 -->
