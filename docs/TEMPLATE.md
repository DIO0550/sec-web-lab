# [脆弱性の英語正式名] — [日本語での簡潔な説明]

<!--
  このテンプレートは docs/ 配下の各ラボドキュメントの雛形です。
  新規作成・既存ドキュメントの改善時にこのテンプレートに沿って記述してください。

  ルール:
  - [ ] で囲まれた部分はラボごとに置き換える
  - 「必須」マークのセクションは必ず記述する
  - 「任意」マークのセクションは該当する場合のみ記述する
  - 日本語で記述する（学習者向け）
  - コード例にはコメントで「なぜ脆弱か」「なぜ安全か」を明記する
-->

> **一言で言うと**: [専門用語をできるだけ使わず、「何が起きるか」を1文で説明する。初学者がこの1文だけ読んで「このラボで何を学ぶか」がわかるように書く。]

---

<!-- ============================================================
  セクション: 攻撃・対策フロー図（必須）
  - diagrams/ サブディレクトリに攻撃図と対策図の2枚1組で配置する
  - ファイル名: <lab-name>-attack.svg, <lab-name>-defense.svg
  - security-svg-diagram スキルで生成する
============================================================ -->

## 攻撃・対策フロー図

| 攻撃図 | 対策図 |
|--------|--------|
| ![攻撃フロー](diagrams/[lab-name]-attack.svg) | ![対策フロー](diagrams/[lab-name]-defense.svg) |

---

<!-- ============================================================
  セクション: 対象ラボ（必須）
  - 既存の概要・攻撃例・技術スタック・難易度は維持
  - 「前提知識」フィールドを追加して学習順序を明示する
  - 複数シナリオがある場合は ### 2. ### 3. と番号を増やす
============================================================ -->

## 対象ラボ

### 1. [ラボシナリオ名]

| 項目 | 内容 |
|------|------|
| **概要** | [何が脆弱で、結果として何が起きるかを具体的に記述] |
| **攻撃例** | `[具体的な入力値、curl コマンド、ペイロード等]` |
| **技術スタック** | [Hono API / React / PostgreSQL 等、使用するコンポーネント] |
| **難易度** | ★☆☆ 入門 / ★★☆ 中級 / ★★★ 上級 |
| **前提知識** | [このラボの前に理解しておくべき概念やラボ。例: 「HTTPの基本」「Step 2: XSS」等] |

<!-- 複数のラボシナリオがある場合 -->
<!--
### 2. [別のラボシナリオ名]

| 項目 | 内容 |
|------|------|
| **概要** | ... |
| **攻撃例** | ... |
| **技術スタック** | ... |
| **難易度** | ★★☆ |
| **前提知識** | ... |
-->

---

<!-- ============================================================
  セクション: 背景知識（必須）
  - このラボの脆弱性を理解するのに必要な技術的背景
  - HTTP/Cookie/SQL 等の基礎を毎回ゼロから書くのではなく、
    このラボに直接関わる部分だけを3-5段落で解説する
  - 「なぜこの仕組みが存在するのか」→「その仕組みのどこに弱点があるか」
    という流れで書くと理解しやすい
============================================================ -->

## 背景知識

### [関連する技術・仕組みの名前] とは

[この脆弱性に関連する技術的な仕組みを説明する。例えば CSRF なら「Cookie によるセッション管理」、SQLi なら「SQL によるデータ問い合わせ」の仕組みを、この攻撃に関係する部分に絞って解説する。]

[仕組みの「通常の動作」を説明した上で、「どこに弱点が生まれるか」を自然な流れで示す。]

### この脆弱性が生まれる原因

[開発者がどのような実装ミスや設計判断をした場合にこの脆弱性が発生するかを説明する。「〜を信頼してしまう」「〜の検証が欠けている」といった形で根本原因に触れる。]

---

<!-- ============================================================
  セクション: 攻撃の仕組み（必須）
  - 3つのサブセクションで構成する:
    1. フローの説明: 番号付きステップで攻撃の流れ
    2. なぜ成功するのか: 成功要因をテーブル形式で整理
    3. 根本原因と対策: 脆弱/安全なコード・設定の比較
============================================================ -->

## 攻撃の仕組み

### フローの説明

<!-- 攻撃・対策フロー図のステップ番号に対応させる -->

1. **攻撃者** が [最初のアクション]
2. **[サーバー / ブラウザ / 被害者]** が [どう反応するか]
3. [中間ステップ: データがどう流れるか、どこで不正な処理が起きるか]
4. [結果: 攻撃者が何を得るか、被害者に何が起きるか]

### なぜ成功するのか

<!-- 攻撃が成立するために必要な条件・前提を列挙する -->

| 要素 | 説明 |
|------|------|
| [成功要因 1] | [なぜこの要素が攻撃を可能にするのか] |
| [成功要因 2] | [なぜこの要素が攻撃を可能にするのか] |
| [成功要因 3] | [なぜこの要素が攻撃を可能にするのか] |

### 根本原因と対策

<!-- 脆弱なコード/設定と安全なコード/設定を並べて比較する -->

| | 方法 |
|---|---|
| ✗ **脆弱** | [脆弱な実装の説明。可能ならコード例を含める] |
| ✓ **安全** | [安全な実装の説明。可能ならコード例を含める] |

[対策がなぜ有効なのか、1-2文で補足する。「〜を防ぐ」だけでなく「なぜ防げるのか」の理由まで書く。]

<!-- インジェクション系のラボでは、コード比較をより具体的に書く -->
<!--
**脆弱なコード:**

```typescript
// ⚠️ ユーザー入力を直接SQL文に結合 → 任意のSQLが実行可能
const result = await pool.query(
  `SELECT * FROM users WHERE username = '${username}'`
);
```

**安全なコード:**

```typescript
// ✅ パラメータ化クエリ → ユーザー入力がSQL構文として解釈されない
const result = await pool.query(
  'SELECT * FROM users WHERE username = $1',
  [username]
);
```
-->

---

<!-- ============================================================
  セクション: ハンズオン手順（必須）
  - 学習者が実際に手を動かす手順
  - 必ず「脆弱バージョンで攻撃を体験」→「安全バージョンで防御を確認」の
    2段階で構成する
  - コマンドやURLは具体的に書き、コピペで試せるようにする
  - 確認ポイントで理解度をセルフチェックできるようにする
============================================================ -->

## ハンズオン手順

### Step 1: 脆弱バージョンで攻撃を体験

[このステップのゴール: 「〜が成功することを確認する」]

1. [環境の準備手順。例: 開発サーバーを起動する、ブラウザで特定のURLを開く]

2. [攻撃の実行手順。具体的なコマンドやブラウザ操作を記述]

   ```bash
   # [実行するコマンドの例]
   curl -X POST http://localhost:3000/api/labs/[lab-name]/vulnerable/[endpoint] \
     -H "Content-Type: application/json" \
     -d '{"[key]": "[攻撃ペイロード]"}'
   ```

3. [結果の確認方法と観察ポイント]

   - 何が返ってくるか
   - DevTools のどのタブで何を確認するか
   - **なぜこの結果になるのか** を考える

### Step 2: 安全バージョンで防御を確認

[このステップのゴール: 「同じ攻撃が失敗することを確認する」]

1. [安全なエンドポイントに切り替える手順]

   ```bash
   # [安全なバージョンで同じ操作を実行]
   curl -X POST http://localhost:3000/api/labs/[lab-name]/secure/[endpoint] \
     -H "Content-Type: application/json" \
     -d '{"[key]": "[攻撃ペイロード]"}'
   ```

2. [結果の確認: 攻撃がどのように防がれるか]

3. [コードの差分を確認する]

   - `backend/src/labs/[lab-name].ts` を開いて脆弱/安全なコードの違いを見る
   - **どの1行が違いを生んでいるか** に注目する

### 確認ポイント

以下を自分の言葉で説明できれば、このラボは完了です:

- [ ] この脆弱性はどのような条件で発生するか
- [ ] 攻撃者は具体的に何を行い、何を得られるか
- [ ] 根本原因は何か（コード/設計のどこに問題があるか）
- [ ] 安全な実装はなぜこの攻撃を防げるのか

---

<!-- ============================================================
  セクション: 実装メモ（必須）
  - ラボの実装時に参照する技術的なメモ
  - ファイルパスや DB テーブルなど具体的な情報を記述
============================================================ -->

## 実装メモ

- **脆弱エンドポイント**: `/api/labs/[lab-name]/vulnerable/[endpoint]`
- **安全エンドポイント**: `/api/labs/[lab-name]/secure/[endpoint]`
- **バックエンド**: `backend/src/labs/[lab-name].ts`
- **フロントエンド**: `frontend/src/pages/[LabName].tsx`
- **DB** (該当する場合): `docker/db/init.sql` に [テーブル名] を追加
- [その他の実装上の注意点]

---

<!-- ============================================================
  セクション: 現実世界での事例（任意）
  - 有名なセキュリティインシデントがある場合に記述
  - 「教科書の話ではなく実際に起きたこと」と示すことで学習の動機付けになる
  - 1-2件に絞り、概要のみ簡潔に書く
============================================================ -->

## 現実世界での事例

| 年 | インシデント | 概要 |
|----|-------------|------|
| [年] | [インシデント名] | [何が起きたか、どの脆弱性が原因だったかを1-2文で] |

---

<!-- ============================================================
  セクション: 関連ラボ（任意）
  - 他のラボと明確な技術的関連がある場合に記述
  - 「前提→発展」「同じカテゴリ」「組み合わせ」等の関連を明示
============================================================ -->

## 関連ラボ

| ラボ | 関連性 |
|------|--------|
| [関連ラボ名](../stepXX-xxx/yyy.md) | [どう関連するかの説明。例: 「XSSで盗んだCookieを使ってこのラボのセッションハイジャックを行える」] |

---

<!-- ============================================================
  セクション: 参考資料（必須）
  - OWASP のリンクは必須
  - CWE 番号がある場合は含める
  - その他の有用なリンクがあれば追加
============================================================ -->

## 参考資料

- [OWASP - [脆弱性名]]([OWASPのURL])
- [CWE-[番号]: [名前]]([CWEのURL]) <!-- 該当する場合 -->
